import cv2
import numpy as np
import os
def main():
    shanks_origin=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\ok\shanks.jpg"
    test_1=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an2.jpg"
    test_2=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an3.jpg"
    test_3=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an4.jpg"
    test_4=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an1.jpg"
    img = cv2.imread(test_4)
    grayimg = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)

    custom_cascade = cv2.CascadeClassifier(r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\cascade\cascade.xml")

    custom_rect = custom_cascade.detectMultiScale(grayimg,scaleFactor=1.1,minNeighbors=3,
                                                minSize=(30,3))


    print(custom_rect)
    for rect in custom_rect:
        cv2.rectangle(img,tuple(rect[0:2]), tuple(rect[0:2]+rect[2:4]),(0,0,255),thickness=3)

    cv2.imshow("image",img)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
                      
shanks_origin=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\ok\shanks.jpg"
test_1=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an2.jpg"
test_2=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an3.jpg"
test_3=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an4.jpg"
test_4=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\an1.jpg"     
test_5=r"C:\Users\onoga\desktop\MyDocker\Git\sqlite\onogam\sumple\sawa.jpg"                 

def test (img, cascade):                    
    # 入力画像の読み込み（テスト用画像ファイル）
    img = cv2.imread(img)

    # カスケード型識別器（自作した分類器）
    cascade = cv2.CascadeClassifier(cascade)

    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

    # face→ballに変更（そのままでもいいですけど）
    ball = cascade.detectMultiScale(gray, scaleFactor=1.1, minNeighbors=3, minSize=(30, 30))
    print(ball)
    # 顔領域を赤色の矩形で囲む
    for (x, y, w, h) in ball:
        cv2.rectangle(img, (x, y), (x + w, y+h), (0,255,20), 2)

    # 結果画像を保存
    #cv2.imwrite("result_tennisball.jpg",img)

    #結果画像を表示
    cv2.imshow('image', img)
    cv2.waitKey(0)
    
def video(cascade):
    video = cv2.VideoCapture(0)
    cascade = cv2.CascadeClassifier(cascade)
    while video.isOpened():
        ret,frame = video.read()
        facerect = cascade.detectMultiScale(frame, scaleFactor = 2,
                                            minNeighbors=4,minSize=(30,30))
        
        
        
        if len(facerect) > 0:
            cv2.putText(frame, 'True', (500, 30), cv2.FONT_HERSHEY_PLAIN, 1.5, (0,255,0), thickness=2)
            #for rect in facerect:
                #cv2.rectangle(frame,tuple(rect[0:2]),tuple(rect[0:2]+rect[2:4]),color=(255,0,0),thickness=2)
            for (x,y,width,height) in facerect:
                cv2.rectangle(frame,(x,y),(x+width,y+height),(255,0,0),2)
                
        cv2.imshow("",frame)
        key = cv2.waitKey(1) & 0xFF
        if key == ord('q'): break

#list = []        
#imlist = os.listdir(r"C:\Users\onoga\desktop\MyDocker\Git\origin\test\pos")
#imlist.remove("poslist.txt")
#for i in imlist:
#    name = os.path.join(r"C:\Users\onoga\desktop\MyDocker\Git\origin\test\pos", i)
#    list.append(name)
#for i in list:
#    
#    test(img=i,cascade=r"onogam\cascade.xml")
#
#    
video(r"C:\Users\onoga\Desktop\cascade.xml")


#list = os.chdir(r"C:\Users\onoga\Desktop\onotes\bus")
#list_file = os.listdir(r"C:\Users\onoga\Desktop\onotes\bus")
#for i in list_file:

#    test(img= r"{}".format(i) ,cascade=r"C:\Users\onoga\Desktop\onotes\cascade\cascade.xml")
